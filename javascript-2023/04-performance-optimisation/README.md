# 性能优化

## 内存管理

- 内存：有可读写单元组成，表示一片可操作空间
- 管理：通过操作 api 去对空间进行申请、使用和释放

```js
// 申请
let obj = {}
// 使用（读写）
obj.name = 'name'
// 释放
obj = null
```

## 垃圾回收 

- javascript 中内存管理是自动的
- 对象不再被引用时是垃圾
- 对象不能从根上访问到时就是垃圾

意思就是加入我们从根（全局变量）出发，无法找到一条路径去找到该变量的引用，那这个变量就是垃圾，会被 javascript 处理处理掉

### GC算法

- GC 就是垃圾回收机制的简写
- GC 可以找到内存中的垃圾、并释放和回收空间
- 算法就是工作时查找和回收遵循的规则

### 引用计数算法

> 通过引用计数器，在引用关系发生改变时，修改引用数字，如果等于了，则立即回收

#### 优缺点

优点：
- 发现垃圾时立即回收
- 最大限度减少程序暂停（因为时刻可以回收，所有减少内存爆满的情况）
缺点：
- 没有办法回收循环引用
- 时间开销大（因为要时刻监控引用数的修改）

```js
// 循环引用
function fn() {
  const obj1 = {}
  const obj2 = {}

  obj1.name = obj2
  obj2.name = obj1

  return 
}

fn()
```

### 标记清除算法

- 核心思想：标记和清除两个阶段完成
- 遍历所有对象找到标记的活动对象
- 遍历所有对象清除没有标记对象

#### 优缺点

优点：
- 可以回收循环引用

缺点：
- 收回的内存空间可能会地址不连续，造成空间碎片化

### 标记整理算法

- 是标记清除算法的增强
- 第一步也会先标记
- 第二步会先整理，将内存变得连续

## V8

> 是一款主流的Javascript执行引擎

- V8 采用即时编译
- V8 内存有设限

### V8 垃圾回收策略

- 分代回收思想
- 内存分为新生代、老生代
- 针对不同的代采用具体的算法

常用的算法：
- 分代回收
- 空间复制
- 标记清除
- 标记整理
- 标记增量

#### 回收新生代

新生代指存活时间短的对象，例如函数内的局部变量

回收过程采用复制算法 + 标记整理
 
## Performance

时刻监控内存

### 内存问题的外在表现

- 页面出现延迟或者暂停
- 性能很差

在浏览器中 shift + esc 可以调出浏览器的任务管理器，可以查看内存
